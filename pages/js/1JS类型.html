<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于类型，有哪些你不知道的细节？ | wendZzoo</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="耶斯莫拉">
    
    <link rel="preload" href="/assets/css/0.styles.f30de916.css" as="style"><link rel="preload" href="/assets/js/app.0764bc43.js" as="script"><link rel="preload" href="/assets/js/7.df5249e8.js" as="script"><link rel="preload" href="/assets/js/25.4a82fb8f.js" as="script"><link rel="prefetch" href="/assets/js/1.f5ace8fd.js"><link rel="prefetch" href="/assets/js/10.f5c4c46e.js"><link rel="prefetch" href="/assets/js/11.7e3d14ae.js"><link rel="prefetch" href="/assets/js/12.a6a54196.js"><link rel="prefetch" href="/assets/js/13.e3898570.js"><link rel="prefetch" href="/assets/js/14.b3e69fbc.js"><link rel="prefetch" href="/assets/js/15.dae0c0bf.js"><link rel="prefetch" href="/assets/js/16.542d9324.js"><link rel="prefetch" href="/assets/js/17.e12f1d49.js"><link rel="prefetch" href="/assets/js/18.1d2e2236.js"><link rel="prefetch" href="/assets/js/19.f7c4ad39.js"><link rel="prefetch" href="/assets/js/2.2767aac7.js"><link rel="prefetch" href="/assets/js/20.60b9d0dc.js"><link rel="prefetch" href="/assets/js/21.f93eaacc.js"><link rel="prefetch" href="/assets/js/22.803aa9bd.js"><link rel="prefetch" href="/assets/js/23.9935b94f.js"><link rel="prefetch" href="/assets/js/24.159312e1.js"><link rel="prefetch" href="/assets/js/26.88216395.js"><link rel="prefetch" href="/assets/js/27.4ce830f5.js"><link rel="prefetch" href="/assets/js/28.efe8daa0.js"><link rel="prefetch" href="/assets/js/29.59b97d3d.js"><link rel="prefetch" href="/assets/js/3.a18bd02b.js"><link rel="prefetch" href="/assets/js/30.01b4bee6.js"><link rel="prefetch" href="/assets/js/31.56826f9e.js"><link rel="prefetch" href="/assets/js/32.3a3cc3f0.js"><link rel="prefetch" href="/assets/js/33.12cd56b0.js"><link rel="prefetch" href="/assets/js/34.1909513a.js"><link rel="prefetch" href="/assets/js/35.943ed2a0.js"><link rel="prefetch" href="/assets/js/36.0043e3d4.js"><link rel="prefetch" href="/assets/js/4.42f5992f.js"><link rel="prefetch" href="/assets/js/5.1e843b35.js"><link rel="prefetch" href="/assets/js/8.f72137d6.js"><link rel="prefetch" href="/assets/js/9.3c1d537e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f30de916.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">wendZzoo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/guide/introduce.html" class="nav-link">
  个人
</a></li><li class="dropdown-item"><!----> <a href="/pages/guide/about.html" class="nav-link">
  关于
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/guide/introduce.html" class="nav-link">
  个人
</a></li><li class="dropdown-item"><!----> <a href="/pages/guide/about.html" class="nav-link">
  关于
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>关于类型，有哪些你不知道的细节？</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/js/1JS%E7%B1%BB%E5%9E%8B.html#类型" class="sidebar-link">类型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/1JS%E7%B1%BB%E5%9E%8B.html#undefined、null" class="sidebar-link">Undefined、Null</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/1JS%E7%B1%BB%E5%9E%8B.html#string" class="sidebar-link">String</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/1JS%E7%B1%BB%E5%9E%8B.html#number" class="sidebar-link">Number</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/1JS%E7%B1%BB%E5%9E%8B.html#symbol" class="sidebar-link">Symbol</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/1JS%E7%B1%BB%E5%9E%8B.html#object" class="sidebar-link">Object</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>JavaScript 类型对每个前端程序员来说，几乎都是最为熟悉的概念了。基础但不意味着简单，例如下面的几个问题。</p> <ol><li>为什么有的编程规范要求用 void 0 代替 undefined？</li> <li>字符串有最大长度吗？</li> <li>0.1 + 0.2 不是等于 0.3 么？为什么 JavaScript 里不是这样的？</li> <li>ES6 新加入的 Symbol 是个什么东西？</li> <li>为什么给对象添加的方法能用在基本类型上？</li></ol> <p>从 JavaScript 的结构树上可以看出，这篇文章是从运行时的角度去看 JavaScript 的类型系统。</p> <p>运行时类型是代码实际执行过程中我们用到的类型。所有的类型数据都会属于 7 个类型之一。从变量、参数、返回值到表达式中间结果，任何 JavaScript 代码运行过程中产生的数据，都具有运行时类型。</p> <h2 id="类型"><a href="#类型" class="header-anchor">#</a> 类型</h2> <p>JavaScript 语言的每一个值都属于某一种数据类型。JavaScript 语言规定了 7 种语言类型。语言类型广泛用于变量、函数参数、表达式、函数返回值等场合。根据最新的语言标准，这 7 种语言类型是：</p> <ul><li>Undefined；</li> <li>Null；</li> <li>Boolean；</li> <li>String；</li> <li>Number；</li> <li>Symbol；</li> <li>Object；</li></ul> <p>除了 ES6 中新加入的 Symbol 类型，剩下 6 种类型都是我们日常开发中的常见的，下面来具体说一下。</p> <h2 id="undefined、null"><a href="#undefined、null" class="header-anchor">#</a> Undefined、Null</h2> <p>第一个问题，为什么有的编程规范要求用 void 0 代替 undefined？</p> <p>Undefined 类型表示未定义，它的类型只有一个值，就是 undefined。任何变量在赋值前是 Undefined 类型、值为 undefined，一般我们可以用全局变量 undefined（就是名为 undefined 的这个变量）来表达这个值，或者 void 运算来把任意一个表达式变成 undefined 值。</p> <p>但是呢，因为 JavaScript 的代码 undefined 是一个变量，而并非是一个关键字，这是 JavaScript 语言公认的设计失误之一，所以，建议使用 void 0 来获取 undefined 值。</p> <p>Undefined 跟 Null 有一定的表意差别，Null 表示的是：“定义了但是为空”。所以，在实际编程时，我们一般不会把变量赋值为 undefined，这样可以保证所有值为 undefined 的变量，都是从未赋值的自然状态。</p> <p>Null 类型也只有一个值，就是 null，它的语义表示空值，与 undefined 不同，null 是 JavaScript 关键字，所以在任何代码中，你都可以放心用 null 关键字来获取 null 值。</p> <h2 id="string"><a href="#string" class="header-anchor">#</a> String</h2> <p>第二个问题，字符串是否有最大长度。</p> <p>String 用于表示文本数据。String 有最大长度是 2^53 - 1，这在一般开发中都是够用的，但是有趣的是，这个所谓最大长度，并不完全是你理解中的字符数。</p> <p>因为 String 的意义并非“字符串”，而是字符串的 UTF16 编码，我们字符串的操作 charAt、charCodeAt、length 等方法针对的都是 UTF16 编码。所以，字符串的最大长度，实际上是受字符串的编码长度影响的。</p> <blockquote><p>Note：现行的字符集国际标准，字符是以 Unicode 的方式表示的，每一个 Unicode 的码点表示一个字符，理论上，Unicode 的范围是无限的。UTF 是 Unicode 的编码方式，规定了码点在计算机中的表示方法，常见的有 UTF16 和 UTF8。 Unicode 的码点通常用 U+??? 来表示，其中 ??? 是十六进制的码点值。 0-65536（U+0000 - U+FFFF）的码点被称为基本字符区域（BMP）。</p></blockquote> <p>JavaScript 中的字符串是永远无法变更的，一旦字符串构造出来，无法用任何方式改变字符串的内容，所以字符串具有值类型的特征。</p> <p>JavaScript 字符串把每个 UTF16 单元当作一个字符来处理，所以处理非 BMP（超出 U+0000 - U+FFFF 范围）的字符时，应该格外小心。</p> <p>JavaScript 这个设计继承自 Java，最新标准中是这样解释的，这样设计是为了“性能和尽可能实现起来简单”。因为现实中很少用到 BMP 之外的字符。</p> <h2 id="number"><a href="#number" class="header-anchor">#</a> Number</h2> <p>第三个问题，0.1 + 0.2 不是等于 0.3 么？</p> <p>Number 类型表示我们通常意义上的“数字”。这个数字大致对应数学中的有理数，当然，在计算机中，我们有一定的精度限制。</p> <p>JavaScript 中的 Number 类型有 18437736874454810627(即 2^64-2^53+3) 个值。</p> <p>JavaScript 中的 Number 类型基本符合 IEEE 754-2008 规定的双精度浮点数规则，但是 JavaScript 为了表达几个额外的语言场景（比如不让除以 0 出错，而引入了无穷大的概念），规定了几个例外情况：</p> <ul><li>NaN，占用了 9007199254740990，这原本是符合 IEEE 规则的数字；</li> <li>Infinity，无穷大；</li> <li>-Infinity，负无穷大。</li></ul> <p>另外，值得注意的是，JavaScript 中有 +0 和 -0，在加法类运算中它们没有区别，但是除法的场合则需要特别留意区分，“忘记检测除以 -0，而得到负无穷大”的情况经常会导致错误，而区分 +0 和 -0 的方式，正是检测 1/x 是 Infinity 还是 -Infinity。</p> <p>根据双精度浮点数的定义，Number 类型中有效的整数范围是 -0x1fffffffffffff 至 0x1fffffffffffff，所以 Number 无法精确表示此范围外的整数。</p> <p>同样根据浮点数的定义，非整数的 Number 类型无法用 ==（=== 也不行） 来比较，一段著名的代码，为什么在 JavaScript 中，0.1+0.2 不能 =0.3：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">==</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>检查等式左右两边差的绝对值是否小于最小精度，才是正确的比较浮点数的方法。这段代码结果就是 true 了。</p> <h2 id="symbol"><a href="#symbol" class="header-anchor">#</a> Symbol</h2> <p>第四个问题，Symbol 是个什么东西？</p> <p>Symbol 是 ES6 中引入的新类型，它是一切非字符串的对象 key 的集合，在 ES6 规范中，整个对象系统被用 Symbol 重塑。</p> <p>Symbol 可以具有字符串类型的描述，但是即使描述相同，Symbol 也不相等。我们创建 Symbol 的方式是使用全局的 Symbol 函数。例如：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> mySymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;my symbol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一些标准中提到的 Symbol，可以在全局的 Symbol 函数的属性中找到。例如，我们可以使用 Symbol.iterator 来自定义 for…of 在对象上的行为：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

o<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> v<span class="token operator">++</span><span class="token punctuation">,</span> done<span class="token operator">:</span> v <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> o<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 1 2 3 ... 9</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码中我们定义了 iterator 之后，用 for(var v of o) 就可以调用这个函数，然后我们可以根据函数的行为，产生一个 for…of 的行为。</p> <p>这里我们给对象 o 添加了 Symbol.iterator 属性，并且按照迭代器的要求定义了一个 0 到 10 的迭代器，之后我们就可以在 for of 中愉快地使用这个 o 对象啦。</p> <p>这些标准中被称为“众所周知”的 Symbol，也构成了语言的一类接口形式。它们允许编写与语言结合更紧密的 API。</p> <h2 id="object"><a href="#object" class="header-anchor">#</a> Object</h2> <p>第五个问题，为什么给对象添加的方法能用在基本类型上？</p> <p>Object 是 JavaScript 中最复杂的类型，也是 JavaScript 的核心机制之一。Object 表示对象的意思，它是一切有形和无形物体的总称。</p> <p>在 JavaScript 中，对象的定义是“属性的集合”。属性分为数据属性和访问器属性，二者都是 key-value 结构，key 可以是字符串或者 Symbol 类型。</p> <p>提到对象，我们必须要提到一个概念：类。因为 C++ 和 Java 的成功，在这两门语言中，每个类都是一个类型，二者几乎等同，以至于很多人常常会把 JavaScript 的“类”与类型混淆。</p> <p>事实上，JavaScript 中的“类”仅仅是运行时对象的一个私有属性，而 JavaScript 中是无法自定义类型的。</p> <p>JavaScript 中的几个基本类型，都在对象类型中有一个“亲戚”。</p> <p>它们是：</p> <ul><li>Number；</li> <li>String；</li> <li>Boolean；</li> <li>Symbol。</li></ul> <p>所以，我们必须认识到 3 与 new Number(3) 是完全不同的值，它们一个是 Number 类型， 一个是对象类型。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token number">3</span> <span class="token operator">===</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token number">3</span> <span class="token operator">===</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Number、String 和 Boolean，三个构造器是两用的，当跟 new 搭配时，它们产生对象，当直接调用时，它们表示强制类型转换。</p> <p>Symbol 函数比较特殊，直接用 new 调用它会抛出错误，但它仍然是 Symbol 对象的构造器。</p> <p>JavaScript 语言设计上试图模糊对象和基本类型之间的关系，我们日常代码可以把对象的方法在基本类型上使用，比如：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>甚至我们在原型上添加方法，都可以应用于基本类型，比如以下代码，在 Symbol 原型上添加了 hello 方法，在任何 Symbol 类型变量都可以调用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Symbol</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//symbol，a并非对象</span>
a<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello，有效</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>所以这个问题的答案就是. 运算符提供了装箱操作，它会根据基础类型构造一个临时对象，使得我们能在基础类型上调用对应对象的方法。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0764bc43.js" defer></script><script src="/assets/js/7.df5249e8.js" defer></script><script src="/assets/js/25.4a82fb8f.js" defer></script>
  </body>
</html>
